# ============================================================================
# File: tasks/backup_single_app.yml
# Reusable task to backup a single application
# Called by backup playbooks, not run directly
# ============================================================================
---
- name: "Backup {{ app_backup_definitions[app_key].name }}"
  block:
    - name: Set app definition
      set_fact:
        app_def: "{{ app_backup_definitions[app_key] }}"
    
    - name: "Create backup directory for {{ app_def.name }}"
      file:
        path: "{{ backup_base }}/{{ item.dest }}"
        state: directory
        mode: '0755'
      loop: "{{ app_def.paths }}"
      loop_control:
        label: "{{ item.dest }}"
    
    - name: "Backup paths for {{ app_def.name }}"
      include_tasks: backup_single_path.yml
      loop: "{{ app_def.paths }}"
      loop_control:
        loop_var: path_item
        label: "{{ path_item.src }}"