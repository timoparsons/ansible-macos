---
# Baseline settings for all machine types

###############################################################################
# General UI/UX
###############################################################################
- name: Expand save and print panels by default
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: "{{ item }}"
    type: bool
    value: true
    state: present
  loop:
    - NSNavPanelExpandedStateForSaveMode
    - NSNavPanelExpandedStateForSaveMode2
    - PMPrintingExpandedStateForPrint
    - PMPrintingExpandedStateForPrint2
  notify: Refresh Preferences

- name: Save to disk (not iCloud) by default
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: NSDocumentSaveNewDocumentsToCloud
    type: bool
    value: false
    state: present
  notify: Refresh Preferences


###############################################################################
# Menu Bar
###############################################################################
- name: Configure menu bar clock
  community.general.osx_defaults:
    domain: com.apple.menuextra.clock
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'ShowDate', type: 'int', value: 1 }
  notify: Restart SystemUIServer

###############################################################################
# Trackpad & Mouse
###############################################################################
- name: Enable tap to click
  community.general.osx_defaults:
    domain: "{{ item.domain }}"
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { domain: 'com.apple.driver.AppleBluetoothMultitouch.trackpad', key: 'Clicking', type: 'int', value: 1 }  # ‚Üê Changed from bool to int
    - { domain: 'NSGlobalDomain', key: 'com.apple.mouse.tapBehavior', type: 'int', value: 1 }
  notify: Restart SystemUIServer

- name: Enable trackpad right-click with two fingers (boolean settings)
  community.general.osx_defaults:
    domain: "{{ item.domain }}"
    key: "{{ item.key }}"
    type: bool
    value: true
    state: present
  loop:
    - { domain: 'com.apple.driver.AppleBluetoothMultitouch.trackpad', key: 'TrackpadRightClick' }
    - { domain: 'com.apple.AppleMultitouchTrackpad', key: 'TrackpadRightClick' }
  notify: Restart SystemUIServer

- name: Enable trackpad right-click gesture (integer setting)
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: ContextMenuGesture
    type: int
    value: 1
    state: present
  notify: Restart SystemUIServer

###############################################################################
# Keyboard & Text
###############################################################################
- name: Disable text substitutions (smart quotes, dashes, etc)
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: "{{ item }}"
    type: bool
    value: false
    state: present
  loop:
    - NSAutomaticSpellingCorrectionEnabled
    - NSAutomaticQuoteSubstitutionEnabled
    - NSAutomaticDashSubstitutionEnabled
    - NSAutomaticPeriodSubstitutionEnabled
  notify: Refresh Preferences

- name: Use F1, F2, etc. as standard function keys
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: com.apple.keyboard.fnState
    type: bool
    value: true
    state: present
  notify: Refresh Preferences

###############################################################################
# Finder Settings
###############################################################################
- name: Configure Finder UI elements
  community.general.osx_defaults:
    domain: com.apple.finder
    key: "{{ item.key }}"
    type: "{{ item.type | default('bool') }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'ShowExternalHardDrivesOnDesktop', value: false }
    - { key: 'ShowHardDrivesOnDesktop', value: false }
    - { key: 'ShowMountedServersOnDesktop', value: false }
    - { key: 'ShowRemovableMediaOnDesktop', value: false }
    - { key: 'ShowStatusBar', value: true }
    - { key: 'ShowPathbar', value: true }
    - { key: 'FXEnableExtensionChangeWarning', value: false }
    - { key: 'FXPreferredViewStyle', type: 'string', value: 'clmv' }
    - { key: '_FXSortFoldersFirst', value: true }
    - { key: 'QLEnableTextSelection', value: true }
    - { key: 'FXDefaultSearchScope', type: 'string', value: 'SCcf' }
    - { key: 'NewWindowTarget', type: 'string', value: 'PfDe' }
  notify: Restart Finder

- name: Enable spring loading for directories
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'com.apple.springing.enabled', type: 'bool', value: true }
    - { key: 'com.apple.springing.delay', type: 'float', value: 0.1 }
  notify: Restart Finder

- name: Avoid creating .DS_Store files on network volumes
  community.general.osx_defaults:
    domain: com.apple.desktopservices
    key: DSDontWriteNetworkStores
    type: bool
    value: true
    state: present
  notify: Restart Finder

- name: Show ~/Library folder
  ansible.builtin.command: chflags nohidden ~/Library
  changed_when: false

- name: Show all filename extensions
  community.general.osx_defaults:
    domain: NSGlobalDomain
    key: AppleShowAllExtensions
    type: bool
    value: true
    state: present
  notify: Restart Finder

###############################################################################
# Desktop & Stage Manager
###############################################################################
- name: Disable click wallpaper to reveal desktop
  community.general.osx_defaults:
    domain: com.apple.WindowManager
    key: EnableStandardClickToShowDesktop
    type: bool
    value: false
    state: present
  notify: Restart Dock

###############################################################################
# Dock & Mission Control
###############################################################################
- name: Configure Dock behavior
  community.general.osx_defaults:
    domain: com.apple.dock
    key: "{{ item.key }}"
    type: "{{ item.type | default('bool') }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'autohide', value: true }
    - { key: 'show-recents', value: false }
    - { key: 'minimize-to-application', value: true }
    - { key: 'mineffect', type: 'string', value: 'scale' }
    - { key: 'expose-animation-duration', type: 'float', value: 0.15 }
    - { key: 'autohide-time-modifier', type: 'float', value: 0.5 }
    - { key: 'showhidden', value: true }
  notify: Restart Dock

###############################################################################
# Hot Corners
###############################################################################
- name: Set Hot Corners
  community.general.osx_defaults:
    domain: com.apple.dock
    key: "{{ item.key }}"
    type: int
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'wvous-tr-corner', value: 4 }
    - { key: 'wvous-tr-modifier', value: 0 }
    - { key: 'wvous-bl-corner', value: 10 }
    - { key: 'wvous-bl-modifier', value: 0 }
  notify: Restart Dock

###############################################################################
# Screenshots
###############################################################################
- name: Configure screenshot settings
  community.general.osx_defaults:
    domain: com.apple.screencapture
    key: "{{ item.key }}"
    type: "{{ item.type }}"
    value: "{{ item.value }}"
    state: present
  loop:
    - { key: 'location', type: 'string', value: '~/Desktop' }
    - { key: 'type', type: 'string', value: 'png' }
    - { key: 'disable-shadow', type: 'bool', value: true }
  notify: Restart SystemUIServer

###############################################################################
# Photos
###############################################################################
- name: Prevent Photos from opening when devices are plugged in
  community.general.osx_defaults:
    domain: com.apple.ImageCapture
    host: currentHost
    key: disableHotPlug
    type: bool
    value: true
    state: present
  notify: Refresh Preferences

###############################################################################
# Safari
###############################################################################
- name: Prevent Safari from auto-opening safe files
  community.general.osx_defaults:
    domain: com.apple.Safari
    key: AutoOpenSafeDownloads
    type: bool
    value: false
    state: present

###############################################################################
# App Store
###############################################################################
- name: Disable in-app rating requests
  community.general.osx_defaults:
    domain: com.apple.appstore
    key: InAppReviewEnabled
    type: int
    value: 0
    state: present